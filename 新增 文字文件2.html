<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‡ºæ±ç¸£æ¶ˆé˜²å±€é ç´„ç³»çµ±æµç¨‹åœ– (å·²é©—è­‰ç‰ˆæœ¬)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.9.0/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Microsoft JhengHei', sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .flow-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .section-title {
            color: #333;
            font-size: 1.8em;
            margin-bottom: 20px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        .mermaid {
            text-align: center;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }
        .tab {
            padding: 12px 24px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 1.1em;
            color: #666;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            margin-bottom: -2px;
        }
        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            font-weight: bold;
        }
        .tab:hover {
            background: #f0f0f0;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš’ è‡ºæ±ç¸£æ¶ˆé˜²å±€é˜²ç½é¤¨é ç´„ç³»çµ±æµç¨‹åœ–</h1>
                
        <div class="flow-section">
            <h2 class="section-title">ğŸ“‹ ä¸»è¦é ç´„åª’åˆæµç¨‹</h2>
            <div class="tabs">
                <button class="tab active" onclick="showTab('main', 0)">å®Œæ•´æµç¨‹</button>
                <button class="tab" onclick="showTab('main', 1)">ç‹€æ…‹è½‰æ›</button>
                <button class="tab" onclick="showTab('main', 2)">åª’åˆé‚è¼¯</button>
            </div>
                        
            <div id="main-0" class="tab-content active">
                <div class="mermaid">
sequenceDiagram
    participant æ°‘çœ¾
    participant å‰ç«¯ç¶²é 
    participant å¾Œç«¯ä¼ºæœå™¨
    participant åª’åˆå¼•æ“
    participant ç®¡ç†è€…
    participant å¿—å·¥
    participant é€šçŸ¥æœå‹™
    Note over æ°‘çœ¾,é€šçŸ¥æœå‹™: ğŸ¯ éšæ®µä¸€ï¼šé ç´„ç”³è«‹
    æ°‘çœ¾->>å‰ç«¯ç¶²é : é€²å…¥é ç´„é é¢
    å‰ç«¯ç¶²é ->>å¾Œç«¯ä¼ºæœå™¨: GET /api/available-slots
    å¾Œç«¯ä¼ºæœå™¨-->>å‰ç«¯ç¶²é : è¿”å›å¯é ç´„æ™‚æ®µ
    å‰ç«¯ç¶²é -->>æ°‘çœ¾: é¡¯ç¤ºé ç´„æ—¥æ›†
    æ°‘çœ¾->>å‰ç«¯ç¶²é : é¸æ“‡æ—¥æœŸæ™‚æ®µ<br/>å¡«å¯«é ç´„è³‡è¨Š
    å‰ç«¯ç¶²é ->>å‰ç«¯ç¶²é : å‰ç«¯é©—è­‰è³‡æ–™
    å‰ç«¯ç¶²é ->>å¾Œç«¯ä¼ºæœå™¨: POST /api/reservations<br/>{visitor, date, timeSlot, groupSize}
    å¾Œç«¯ä¼ºæœå™¨->>å¾Œç«¯ä¼ºæœå™¨: é©—è­‰æ™‚æ®µå¯ç”¨æ€§<br/>å»ºç«‹é ç´„è¨˜éŒ„<br/>ç‹€æ…‹: PENDING
    å¾Œç«¯ä¼ºæœå™¨->>é€šçŸ¥æœå‹™: è§¸ç™¼é ç´„ç¢ºèªé€šçŸ¥
    é€šçŸ¥æœå‹™-->>æ°‘çœ¾: Email: é ç´„ç”³è«‹å·²æ”¶åˆ°
    å¾Œç«¯ä¼ºæœå™¨-->>å‰ç«¯ç¶²é : è¿”å›é ç´„IDèˆ‡ç‹€æ…‹
    å‰ç«¯ç¶²é -->>æ°‘çœ¾: é¡¯ç¤ºç”³è«‹æˆåŠŸè¨Šæ¯
    Note over æ°‘çœ¾,é€šçŸ¥æœå‹™: ğŸ” éšæ®µäºŒï¼šå¯©æ ¸èˆ‡åª’åˆ
    å¾Œç«¯ä¼ºæœå™¨->>ç®¡ç†è€…: æ¨é€å¾…å¯©æ ¸é€šçŸ¥
    ç®¡ç†è€…->>å¾Œç«¯ä¼ºæœå™¨: GET /api/admin/pending-reservations
    å¾Œç«¯ä¼ºæœå™¨-->>ç®¡ç†è€…: è¿”å›å¾…å¯©æ ¸æ¸…å–®
    ç®¡ç†è€…->>å¾Œç«¯ä¼ºæœå™¨: POST /api/admin/approve/{id}
    å¾Œç«¯ä¼ºæœå™¨->>å¾Œç«¯ä¼ºæœå™¨: æ›´æ–°ç‹€æ…‹: AWAITING_VOLUNTEER
    å¾Œç«¯ä¼ºæœå™¨->>åª’åˆå¼•æ“: è§¸ç™¼åª’åˆæµç¨‹
    åª’åˆå¼•æ“->>åª’åˆå¼•æ“: æŸ¥è©¢å¯ç”¨å¿—å·¥<br/>è¨ˆç®—åª’åˆåˆ†æ•¸<br/>ç”Ÿæˆæ¨è–¦æ¸…å–®
    alt è‡ªå‹•åª’åˆæˆåŠŸ
        åª’åˆå¼•æ“->>å¾Œç«¯ä¼ºæœå™¨: è‡ªå‹•æŒ‡æ´¾æœ€ä½³å¿—å·¥
        å¾Œç«¯ä¼ºæœå™¨->>å¾Œç«¯ä¼ºæœå™¨: æ›´æ–°ç‹€æ…‹: CONFIRMED
        å¾Œç«¯ä¼ºæœå™¨->>é€šçŸ¥æœå‹™: è§¸ç™¼å¤šæ–¹é€šçŸ¥
        é€šçŸ¥æœå‹™-->>å¿—å·¥: LINE: æ–°ä»»å‹™æŒ‡æ´¾é€šçŸ¥
        é€šçŸ¥æœå‹™-->>æ°‘çœ¾: Email/SMS: é ç´„ç¢ºèªé€šçŸ¥
    else éœ€è¦æ‰‹å‹•åª’åˆ
        åª’åˆå¼•æ“->>ç®¡ç†è€…: æä¾›æ¨è–¦å¿—å·¥æ¸…å–®
        ç®¡ç†è€…->>å¾Œç«¯ä¼ºæœå™¨: POST /api/admin/assign-volunteer
        å¾Œç«¯ä¼ºæœå™¨->>å¾Œç«¯ä¼ºæœå™¨: æ›´æ–°æŒ‡æ´¾è¨˜éŒ„
        å¾Œç«¯ä¼ºæœå™¨->>é€šçŸ¥æœå‹™: è§¸ç™¼é€šçŸ¥
        é€šçŸ¥æœå‹™-->>å¿—å·¥: LINE: ä»»å‹™é‚€è«‹
        å¿—å·¥->>å¾Œç«¯ä¼ºæœå™¨: POST /api/volunteer/accept-task
        å¾Œç«¯ä¼ºæœå™¨->>å¾Œç«¯ä¼ºæœå™¨: æ›´æ–°ç‹€æ…‹: CONFIRMED
        é€šçŸ¥æœå‹™-->>æ°‘çœ¾: æœ€çµ‚ç¢ºèªé€šçŸ¥
    end
    Note over æ°‘çœ¾,é€šçŸ¥æœå‹™: ğŸ“… éšæ®µä¸‰ï¼šè¡Œå‰æº–å‚™
    å¾Œç«¯ä¼ºæœå™¨->>å¾Œç«¯ä¼ºæœå™¨: å®šæ™‚ä»»å‹™: æª¢æŸ¥24å°æ™‚å…§é ç´„
    å¾Œç«¯ä¼ºæœå™¨->>é€šçŸ¥æœå‹™: è§¸ç™¼è¡Œå‰æé†’
    é€šçŸ¥æœå‹™-->>æ°‘çœ¾: SMS/Email: æ˜æ—¥åƒè§€æé†’
    é€šçŸ¥æœå‹™-->>å¿—å·¥: LINE: æ˜æ—¥æœå‹™æé†’
    Note over æ°‘çœ¾,é€šçŸ¥æœå‹™: âœ… éšæ®µå››ï¼šæ´»å‹•åŸ·è¡Œ
    å¿—å·¥->>å¾Œç«¯ä¼ºæœå™¨: POST /api/volunteer/check-in
    å¾Œç«¯ä¼ºæœå™¨->>å¾Œç«¯ä¼ºæœå™¨: æ›´æ–°ç‹€æ…‹: IN_PROGRESS
    å¿—å·¥->>å¾Œç«¯ä¼ºæœå™¨: POST /api/volunteer/complete-task
    å¾Œç«¯ä¼ºæœå™¨->>å¾Œç«¯ä¼ºæœå™¨: æ›´æ–°ç‹€æ…‹: COMPLETED
    å¾Œç«¯ä¼ºæœå™¨->>é€šçŸ¥æœå‹™: è§¸ç™¼å®Œæˆé€šçŸ¥
    é€šçŸ¥æœå‹™-->>æ°‘çœ¾: Email: æ„Ÿè¬åƒè§€+æ„è¦‹èª¿æŸ¥
                </div>
            </div>
                        
            <div id="main-1" class="tab-content">
                <div class="mermaid">
stateDiagram-v2
    [*] --> è‰ç¨¿: é–‹å§‹å¡«å¯«
    è‰ç¨¿ --> å¾…å¯©æ ¸: æäº¤é ç´„
    è‰ç¨¿ --> [*]: æ”¾æ£„
    å¾…å¯©æ ¸ --> ç­‰å¾…åª’åˆ: å¯©æ ¸é€šé
    å¾…å¯©æ ¸ --> å·²æ‹’çµ•: å¯©æ ¸ä¸é€šé
    å¾…å¯©æ ¸ --> å·²å–æ¶ˆ: ç”¨æˆ¶å–æ¶ˆ
    ç­‰å¾…åª’åˆ --> åª’åˆä¸­: é–‹å§‹åª’åˆ
    åª’åˆä¸­ --> å·²ç¢ºèª: åª’åˆæˆåŠŸ
    åª’åˆä¸­ --> åª’åˆå¤±æ•—: ç„¡å¯ç”¨å¿—å·¥
    åª’åˆå¤±æ•— --> ç­‰å¾…åª’åˆ: é‡æ–°åª’åˆ
    åª’åˆå¤±æ•— --> å·²å–æ¶ˆ: è¶…æ™‚å–æ¶ˆ
    å·²ç¢ºèª --> é€²è¡Œä¸­: æ´»å‹•é–‹å§‹
    å·²ç¢ºèª --> å·²å–æ¶ˆ: å–æ¶ˆé ç´„
    é€²è¡Œä¸­ --> å·²å®Œæˆ: æ´»å‹•çµæŸ
    å·²å®Œæˆ --> å·²è©•åƒ¹: æäº¤è©•åƒ¹
    å·²è©•åƒ¹ --> [*]
    å·²æ‹’çµ• --> [*]
    å·²å–æ¶ˆ --> [*]
                </div>
            </div>
            
            <div id="main-2" class="tab-content">
                <div class="mermaid">
graph TD
    subgraph "ç³»çµ±è‡ªå‹•åŒ–åª’åˆéšæ®µ"
        A[é ç´„æˆç«‹ / å¯©æ ¸é€šé] --> B{æŸ¥è©¢ç¬¦åˆæ™‚æ®µçš„å¯ç”¨å¿—å·¥};
        B -- æ‰¾ä¸åˆ°ä»»ä½•å¿—å·¥ --> F[ç‹€æ…‹æ›´æ–°: åª’åˆå¤±æ•—<br/>ä¸¦é€šçŸ¥ç®¡ç†è€…];
        B -- æ‰¾åˆ°ä¸€ä½æˆ–å¤šä½å¿—å·¥ --> C[ä¾æ“šå…¬å¹³æ€§åŸå‰‡æ’åº<br/>(æœå‹™æ™‚æ•¸ä½è€…å„ªå…ˆã€è¿‘æœŸæœªæœå‹™è€…å„ªå…ˆ)];
        C --> D{å‘æ’åºç¬¬ä¸€çš„å¿—å·¥ç™¼é€é‚€è«‹<br/>(LINE/Email)};
        D --> E{ç­‰å¾…å¿—å·¥åœ¨24å°æ™‚å…§å›è¦†};
        E -- å¿—å·¥æ¥å— --> G[ç‹€æ…‹æ›´æ–°: åª’åˆæˆåŠŸ<br/>ç™¼é€ç¢ºèªé€šçŸ¥çµ¦æ°‘çœ¾èˆ‡å¿—å·¥];
        E -- å¿—å·¥æ‹’çµ•æˆ–è¶…æ™‚ --> H{æ˜¯å¦é‚„æœ‰ä¸‹ä¸€ä½å¿—å·¥?};
        H -- æ˜¯ --> D;
        H -- å¦ --> F;
    end

    subgraph "ç®¡ç†è€…äººå·¥ä»‹å…¥éšæ®µ"
        F --> I[ç®¡ç†è€…ç™»å…¥ç³»çµ±<br/>æŸ¥çœ‹åª’åˆå¤±æ•—æ¡ˆä»¶];
        I --> J{æ‰‹å‹•è¯ç¹«å…¶ä»–å¿—å·¥æˆ–èª¿æ•´æ’ç­};
        J -- æˆåŠŸæ‰¾åˆ°äººé¸ --> K[æ‰‹å‹•æŒ‡æ´¾å¿—å·¥];
        J -- ä»æ‰¾ä¸åˆ°äººé¸ --> L[è¯ç¹«é ç´„æ°‘çœ¾<br/>(å”èª¿æ›ç­æˆ–å–æ¶ˆ)];
        K --> G;
    end

    G --> Z((æˆåŠŸ));
    L --> Y((çµæŸ));
                </div>
            </div>

        </div>
    </div>

    <script>
        function showTab(prefix, index) {
            const flowSection = document.querySelector('.flow-section');
            if (flowSection) {
                flowSection.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
                flowSection.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

                const allTabs = flowSection.querySelectorAll('.tab');
                if (allTabs[index]) {
                    allTabs[index].classList.add('active');
                }

                const targetContent = document.getElementById(`${prefix}-${index}`);
                if (targetContent) {
                    targetContent.classList.add('active');
                    
                    setTimeout(() => {
                        const mermaidDiagram = targetContent.querySelector('.mermaid');
                        if (mermaidDiagram) {
                            mermaid.run({ nodes: [mermaidDiagram] });
                        }
                    }, 10);
                }
            }
        }
        
        mermaid.initialize({ startOnLoad: false });

        window.addEventListener('load', () => {
            const firstDiagram = document.querySelector('.tab-content.active .mermaid');
            if (firstDiagram) {
                mermaid.run({ nodes: [firstDiagram] });
            }
        });
    </script>
</body>
</html>